@Test
@Tag("FheSerialization")
void serialization() {
  logger.trace("serialization");

  {{testValue tested}}
  {{tested.className}} encrypted = {{tested.className}}.encrypt(originalValue, keySet.clientKey());
  byte[] serialized = encrypted.serialize();
  {{tested.className}} deserialized = {{tested.className}}.deserialize(serialized);
  {{#if tested.compressed}}
    {{tested.compressed.className}} decompressedDeserialized = deserialized.decompress();
    {{tested.dataClass.simpleName}} decrypted = decompressedDeserialized.decrypt(keySet.clientKey());
  {{else}}
    {{tested.dataClass.simpleName}} decrypted = deserialized.decrypt(keySet.clientKey());
  {{/if}}

  assertThat(decrypted).isEqualTo(originalValue);
}
